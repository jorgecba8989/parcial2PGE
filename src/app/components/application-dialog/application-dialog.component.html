<div class="application-dialog">
  <h2 mat-dialog-title>
    <mat-icon>email</mat-icon>
    {{ translateService.translate('sendEmail') }}
  </h2>

  <mat-dialog-content>

    <form [formGroup]="applicationForm" class="application-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ translateService.translate('recipientEmail') }}</mat-label>
        <input matInput
               type="email"
               formControlName="toEmail"
               [placeholder]="translateService.translate('recipientEmailPlaceholder')"
               [attr.aria-label]="translateService.translate('recipientEmailLabel')">
        <mat-icon matSuffix>email</mat-icon>
        <mat-error *ngIf="applicationForm.get('toEmail')?.hasError('required')">
          {{ translateService.translate('recipientEmailRequired') }}
        </mat-error>
        <mat-error *ngIf="applicationForm.get('toEmail')?.hasError('email')">
          {{ translateService.translate('validEmailRequired') }}
        </mat-error>
      </mat-form-field>

      <div class="file-upload-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ translateService.translate('attachment') }}</mat-label>
          <input matInput
                 readonly
                 [value]="selectedFileName"
                 [placeholder]="translateService.translate('selectFile')"
                 [attr.aria-label]="translateService.translate('selectedFile')">
          <mat-icon matSuffix>attach_file</mat-icon>
        </mat-form-field>

        <input #fileInput
               type="file"
               accept=".pdf,.doc,.docx"
               (change)="onFileSelected($event)"
               style="display: none;"
               [attr.aria-label]="translateService.translate('selectedFile')">

        <button mat-stroked-button
                type="button"
                (click)="fileInput.click()"
                class="file-select-button"
                [attr.aria-label]="translateService.translate('selectFileLabel')">
          <mat-icon>folder_open</mat-icon>
          {{ translateService.translate('selectFileButton') }}
        </button>

        <div *ngIf="fileError" class="file-error">
          <mat-icon color="warn">error</mat-icon>
          {{ fileError }}
        </div>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ translateService.translate('message') }}</mat-label>
        <textarea matInput
                  formControlName="message"
                  rows="4"
                  [placeholder]="translateService.translate('messagePlaceholder')"
                  [attr.aria-label]="translateService.translate('messageLabel')">
        </textarea>
        <mat-icon matSuffix>message</mat-icon>
        <mat-error *ngIf="applicationForm.get('message')?.hasError('required')">
          {{ translateService.translate('messageRequired') }}
        </mat-error>
      </mat-form-field>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button
            (click)="onCancel()"
            [attr.aria-label]="translateService.translate('cancelEmailLabel')">
      <mat-icon>close</mat-icon>
      {{ translateService.translate('cancel') }}
    </button>

    <button mat-raised-button
            color="primary"
            (click)="onSubmit()"
            [disabled]="applicationForm.invalid || isLoading"
            [attr.aria-label]="translateService.translate('sendEmailLabel')">
      <mat-icon *ngIf="!isLoading">send</mat-icon>
      <mat-spinner *ngIf="isLoading"
                   diameter="20"
                   strokeWidth="2"
                   color="accent">
      </mat-spinner>
      <span [attr.aria-live]="isLoading ? 'polite' : null">
        {{ isLoading ? translateService.translate('sending') : translateService.translate('send') }}
      </span>
    </button>
  </mat-dialog-actions>
</div>